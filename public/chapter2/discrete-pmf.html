<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>离散型随机变量概率分布可视化</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        body {
            background-color: #f5f7f9;
            min-height: 100vh;
            padding: 10px;
            color: #333;
        }

        .container {
            max-width: 800px;
            /* 减小容器最大宽度 */
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 18px;
            /* 略微增大间距 */
            padding-top: 10px;
        }

        header {
            text-align: center;
            margin-bottom: 18px;
            padding: 18px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.2rem;
            /* 增大标题字体大小约20% */
        }

        h2 {
            color: #2c3e50;
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 1px solid #eaeaea;
            text-align: center;
            font-size: 1.6rem;
            /* 增大标题字体大小约20% */
        }

        .subtitle {
            color: #666;
            font-size: 1.2rem;
            /* 增大副标题字体大小约20% */
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.5;
        }

        .visualization-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 18px;
            margin-bottom: 18px;
        }

        @media (max-width: 768px) {
            .visualization-area {
                grid-template-columns: 1fr;
            }
        }

        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 18px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            height: 380px;
            /* 略微增大图表容器高度 */
            display: flex;
            flex-direction: column;
        }

        .controls {
            background: white;
            border-radius: 10px;
            padding: 24px;
            /* 增大内边距约20% */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 18px;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
            /* 略微增大间距 */
            margin-bottom: 15px;
            /* 略微增大间距 */
            justify-content: center;
        }

        .slider-label {
            font-weight: 600;
            color: #2c3e50;
            min-width: 90px;
            /* 略微增大最小宽度 */
            font-size: 1.15rem;
            /* 增大标签字体大小约20% */
        }

        input[type="range"] {
            flex: 1;
            height: 8px;
            /* 略微增大高度 */
            border-radius: 4px;
            background: #2563eb;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            /* 增大滑块大小约20% */
            height: 24px;
            /* 增大滑块大小约20% */
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            box-shadow: 0 0 10px #2563eb;
            /* 略微增大阴影 */
            transition: all 0.3s ease;
        }

        input[type="range"]::-moz-range-thumb {
            width: 22px;
            /* 增大滑块大小约20% */
            height: 22px;
            /* 增大滑块大小约20% */
            background: #ddd;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        input[type="range"]:hover {
            background: #2563eb;
        }

        .value-display {
            font-weight: bold;
            color: #2563eb;
            min-width: 40px;
            /* 略微增大最小宽度 */
            text-align: center;
            font-size: 1.2rem;
            /* 增大数值显示字体大小约20% */
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            /* 略微增大最小宽度 */
            gap: 15px;
            /* 略微增大间距 */
            margin-top: 18px;
            /* 略微增大间距 */
        }

        .stat-card {
            background: #f8f9fa;
            padding: 18px;
            /* 增大内边距约20% */
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #2563eb;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.1);
        }

        .stat-label {
            font-size: 1rem;
            /* 增大标签字体大小约20% */
            color: #666;
            margin-bottom: 8px;
            /* 略微增大间距 */
        }

        .stat-value {
            font-size: 1.4rem;
            /* 增大数值字体大小约20% */
            font-weight: bold;
            color: #2c3e50;
        }

        .explanation {
            background: white;
            border-radius: 10px;
            padding: 24px;
            /* 增大内边距约20% */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            margin-top: 18px;
            /* 略微增大间距 */
        }

        .explanation h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            /* 略微增大间距 */
            border-bottom: 2px solid #2563eb;
            padding-bottom: 10px;
            /* 略微增大间距 */
        }

        .explanation p {
            line-height: 1.5;
            margin-bottom: 15px;
            /* 略微增大间距 */
            font-size: 1.15rem;
            /* 增大字体大小约20% */
        }

        .math-expr {
            background: #f8f9fa;
            padding: 15px;
            /* 增大内边距约20% */
            border-radius: 6px;
            font-family: 'Cambria Math', serif;
            margin: 15px 0;
            /* 略微增大间距 */
            border-left: 4px solid #e74c3c;
            font-size: 1.15rem;
            /* 增大字体大小约20% */
        }

        .observations {
            margin-top: 18px;
            /* 略微增大间距 */
        }

        .observation-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 10px;
            /* 略微增大间距 */
        }

        .observation-bullet {
            background: #2563eb;
            color: white;
            border-radius: 50%;
            width: 24px;
            /* 增大子弹点大小约20% */
            height: 24px;
            /* 增大子弹点大小约20% */
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            /* 略微增大间距 */
            flex-shrink: 0;
            font-size: 1rem;
            /* 增大字体大小约20% */
        }
    </style>
</head>

<body>
    <div class="container">

        <div class="controls">
            <div class="slider-container">
                <span class="slider-label">n值:</span>
                <input type="range" id="nSlider" min="2" max="50" value="10" step="1">
                <span class="value-display" id="nValue">10</span>
            </div>
            <div class="slider-container">
                <span class="slider-label">动画速度:</span>
                <input type="range" id="speedSlider" min="1" max="10" value="5" step="1">
                <span class="value-display" id="speedValue">5</span>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 15px; justify-content: center;">
                <button id="playBtn"
                    style="padding: 9px 15px; background: #2563eb; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1.15rem;">播放动画</button>
                <button id="resetBtn"
                    style="padding: 9px 15px; background: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1.15rem;">重置</button>
            </div>
        </div>

        <div class="visualization-area">
            <div class="chart-container" id="pmfChart"></div>
            <div class="chart-container" id="cdfChart"></div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-label">期望值 E(X)</div>
                <div class="stat-value" id="expectation">0.5500</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">方差 Var(X)</div>
                <div class="stat-value" id="variance">0.0825</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">标准差 σ(X)</div>
                <div class="stat-value" id="stdDev">0.2872</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">取值数量</div>
                <div class="stat-value" id="valueCount">10</div>
            </div>
        </div>

    </div>

    <script>
        // 获取DOM元素
        const nSlider = document.getElementById('nSlider');
        const nValue = document.getElementById('nValue');
        const speedSlider = document.getElementById('speedSlider');
        const speedValue = document.getElementById('speedValue');
        const playBtn = document.getElementById('playBtn');
        const resetBtn = document.getElementById('resetBtn');
        const pmfChart = document.getElementById('pmfChart');
        const cdfChart = document.getElementById('cdfChart');
        const expectationElem = document.getElementById('expectation');
        const varianceElem = document.getElementById('variance');
        const stdDevElem = document.getElementById('stdDev');
        const valueCountElem = document.getElementById('valueCount');

        // 初始化变量
        let n = parseInt(nSlider.value);
        let animationId = null;

        // 更新显示的值
        nValue.textContent = n;
        speedValue.textContent = speedSlider.value;

        // 计算概率分布
        function calculateDistribution(n) {
            const xValues = [];
            const probabilities = [];
            const labels = [];

            for (let k = 1; k <= n; k++) {
                xValues.push(k / n);
                probabilities.push(1 / n);
                // 简化标签显示，避免过于拥挤
                if (n <= 10) {
                    labels.push(`${k}/${n}`);
                } else {
                    // 对于较大的n，只显示部分标签
                    if (k === 1 || k === n || k % Math.ceil(n / 10) === 0) {
                        labels.push(`${k}/${n}`);
                    } else {
                        labels.push('');
                    }
                }
            }

            return { xValues, probabilities, labels };
        }

        // 计算累积分布函数 - 修正版本
        function calculateCDF(n) {
            // 对于离散分布，CDF是右连续的阶梯函数
            // 我们需要为每个跳跃点创建数据
            const cdfX = [0]; // 从0开始
            const cdfY = [0]; // 在0处的CDF值为0

            for (let k = 1; k <= n; k++) {
                // 在每个跳跃点之前的值
                cdfX.push(k / n);
                cdfY.push((k - 1) / n);

                // 在每个跳跃点之后的值
                cdfX.push(k / n);
                cdfY.push(k / n);
            }

            // 延伸到1之后
            cdfX.push(1.1);
            cdfY.push(1);

            return { cdfX, cdfY };
        }

        // 计算统计量
        function calculateStats(n) {
            // 期望值 E(X) = (n+1)/(2n)
            const expectation = (n + 1) / (2 * n);

            // 方差 Var(X) = (n²-1)/(12n²)
            const variance = (n * n - 1) / (12 * n * n);

            const stdDev = Math.sqrt(variance);

            return {
                expectation,
                variance,
                stdDev
            };
        }

        // 更新图表和统计信息
        function updateVisualization() {
            n = parseInt(nSlider.value);
            nValue.textContent = n;

            const { xValues, probabilities, labels } = calculateDistribution(n);
            const { cdfX, cdfY } = calculateCDF(n);
            const stats = calculateStats(n);

            // 更新统计信息显示
            expectationElem.textContent = stats.expectation.toFixed(4);
            varianceElem.textContent = stats.variance.toFixed(4);
            stdDevElem.textContent = stats.stdDev.toFixed(4);
            valueCountElem.textContent = n;

            // 准备PMF图表数据
            const pmfTrace = {
                x: xValues,
                y: probabilities,
                type: 'bar',
                marker: {
                    color: probabilities.map(p => `rgba(37, 99, 235, ${0.3 + 0.7 * p * n})`),
                    line: {
                        color: 'rgba(37, 99, 235, 1)',
                        width: 1.5
                    }
                },
                name: '概率',
                hovertemplate: '取值: %{x:.3f}<br>概率: %{y:.4f}<extra></extra>'
            };

            const pmfLayout = {
                title: {
                    text: `概率质量函数 (PMF) - n = ${n}`,
                    font: { size: 17 } // 增大图表标题字体大小约20%
                },
                xaxis: {
                    title: '随机变量取值 (k/n)',
                    tickvals: xValues,
                    ticktext: labels,
                    tickangle: -45,
                    range: [0, 1.1],
                    tickfont: { size: 13 } // 增大坐标轴字体大小约20%
                },
                yaxis: {
                    title: '概率 P(X=x)',
                    range: [0, Math.max(0.5, 1 / n * 1.5)],
                    tickfont: { size: 13 } // 增大坐标轴字体大小约20%
                },
                showlegend: false,
                margin: { t: 45, r: 25, b: 70, l: 60 } // 略微增大边距以适应更大的字体
            };

            // 准备CDF图表数据 - 修正版本
            const cdfTrace = {
                x: cdfX,
                y: cdfY,
                type: 'scatter',
                mode: 'lines',
                line: {
                    color: 'rgba(231, 76, 60, 1)',
                    width: 3,
                    shape: 'hv' // 阶梯状
                },
                name: '累积概率',
                hovertemplate: '取值: %{x:.3f}<br>累积概率: %{y:.4f}<extra></extra>'
            };

            const cdfLayout = {
                title: {
                    text: `累积分布函数 (CDF) - n = ${n}`,
                    font: { size: 17 } // 增大图表标题字体大小约20%
                },
                xaxis: {
                    title: '随机变量取值 (k/n)',
                    range: [0, 1.1],
                    tickfont: { size: 13 } // 增大坐标轴字体大小约20%
                },
                yaxis: {
                    title: '累积概率 F(x)',
                    range: [0, 1.05],
                    tickfont: { size: 13 } // 增大坐标轴字体大小约20%
                },
                showlegend: false,
                margin: { t: 45, r: 25, b: 70, l: 60 } // 略微增大边距以适应更大的字体
            };

            // 更新图表
            Plotly.react(pmfChart, [pmfTrace], pmfLayout);
            Plotly.react(cdfChart, [cdfTrace], cdfLayout);
        }

        // 播放动画函数
        function playAnimation() {
            if (animationId) {
                clearInterval(animationId);
                animationId = null;
                playBtn.textContent = '播放动画';
                return;
            }

            playBtn.textContent = '停止动画';
            const speed = 1100 - (speedSlider.value * 100); // 速度值映射到时间间隔

            animationId = setInterval(() => {
                let currentN = parseInt(nSlider.value);
                currentN = currentN >= 50 ? 2 : currentN + 1;
                nSlider.value = currentN;
                updateVisualization();
            }, speed);
        }

        // 重置函数
        function resetVisualization() {
            if (animationId) {
                clearInterval(animationId);
                animationId = null;
                playBtn.textContent = '播放动画';
            }
            nSlider.value = 10;
            updateVisualization();
        }

        // 初始渲染
        updateVisualization();

        // 添加事件监听
        nSlider.addEventListener('input', updateVisualization);
        speedSlider.addEventListener('input', () => {
            speedValue.textContent = speedSlider.value;
            if (animationId) {
                clearInterval(animationId);
                animationId = null;
                playAnimation(); // 重新开始动画以应用新速度
            }
        });
        playBtn.addEventListener('click', playAnimation);
        resetBtn.addEventListener('click', resetVisualization);
    </script>
</body>

</html>