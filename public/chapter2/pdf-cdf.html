<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>概率密度函数与分布函数可视化</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
            color: #333;
        }

        .container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 25px;
            margin-bottom: 20px;
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
        }

        .charts-container {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
        }

        .chart-wrapper {
            flex: 1;
            position: relative;
        }

        .chart-container {
            height: 400px;
        }

        .chart-title {
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .function-def {
            text-align: center;
            margin: 15px 0;
            color: #555;
            line-height: 1.6;
            font-size: 1.1em;
        }

        .math-expression {
            font-family: 'Times New Roman', serif;
            font-weight: bold;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .slider-container {
            flex: 1;
            min-width: 300px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        input[type="range"] {
            width: 100%;
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: #2563eb;
            border-radius: 4px;
            outline: none;
        }

        /* Chrome, Safari, Opera滑块样式 */
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            background: #ffffff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px #2563eb;
            transition: all 0.3s ease;
        }

        /* Firefox滑块样式 */
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #ddd;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        /* 滑块轨道悬停效果 */
        input[type="range"]:hover {
            background: #2563eb;
        }

        .probability-display {
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            color: #2563eb;
            margin: 15px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .info {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="charts-container">
            <div class="chart-wrapper">
                <div class="chart-title">概率密度函数 (PDF)</div>
                <div class="function-def">
                    <p class="math-expression">
                        f(x) = 0.25 &nbsp;&nbsp;&nbsp; 0 ≤ x < 2<br>
                            f(x) = -0.25x + 1 &nbsp;&nbsp;&nbsp; 2 ≤ x ≤ 4<br>
                            f(x) = 0 &nbsp;&nbsp;&nbsp; 其他
                    </p>
                </div>
                <div class="chart-container">
                    <canvas id="pdf-chart"></canvas>
                </div>
                <div class="probability-display">
                    P(<span id="a-value">1.0</span> ≤ X ≤ <span id="b-value">3.0</span>) = <span
                        id="probability">0.500</span>
                </div>
            </div>
            <div class="chart-wrapper">
                <div class="chart-title">分布函数 (CDF)</div>
                <div class="function-def">
                    <p class="math-expression">
                        F(x) = 0 &nbsp;&nbsp;&nbsp; x < 0<br>
                            F(x) = 0.25x &nbsp;&nbsp;&nbsp; 0 ≤ x < 2<br>
                                F(x) = -0.125x² + x - 1 &nbsp;&nbsp;&nbsp; 2 ≤ x ≤ 4<br>
                                F(x) = 1 &nbsp;&nbsp;&nbsp; x > 4
                    </p>
                </div>
                <div class="chart-container">
                    <canvas id="cdf-chart"></canvas>
                </div>
                <div class="probability-display">
                    F(<span id="b-value-f">3.0</span>) - F(<span id="a-value-f">1.0</span>) = <span
                        id="probability-f">0.500</span>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="slider-container">
                <div class="slider-label">
                    <span>区间下限 a:</span>
                    <span id="a-display">1.00</span>
                </div>
                <input type="range" id="a-slider" min="0" max="4" step="0.01" value="1.0">
            </div>

            <div class="slider-container">
                <div class="slider-label">
                    <span>区间上限 b:</span>
                    <span id="b-display">3.00</span>
                </div>
                <input type="range" id="b-slider" min="0" max="4" step="0.01" value="3.0">
            </div>
        </div>


    </div>

    <script>
        // 修正后的分段概率密度函数，确保总面积为1
        function piecewisePDF(x) {
            if (x >= 0 && x < 2) {
                return 0.25;  // 第一段：常数
            } else if (x >= 2 && x <= 4) {
                return -0.25 * x + 1;  // 第二段：线性函数，在x=4处值为0
            } else {
                return 0;
            }
        }

        // 计算分布函数CDF - 修正后的表达式
        function piecewiseCDF(x) {
            if (x < 0) {
                return 0;
            } else if (x >= 0 && x < 2) {
                return 0.25 * x;  // ∫0.25 dx 从0到x
            } else if (x >= 2 && x <= 4) {
                // ∫0.25 dx 从0到2 + ∫(-0.25t + 1) dt 从2到x
                // 第一段积分结果: 0.25 * 2 = 0.5
                // 第二段积分: ∫(-0.25t + 1) dt = -0.125t² + t
                // 从2到x: (-0.125x² + x) - (-0.125*4 + 2) = -0.125x² + x - 1
                return -0.125 * x * x + x - 1;
            } else {
                return 1;
            }
        }

        // 计算区间[a, b]上的概率（曲线下面积）
        function calculateProbability(a, b) {
            // 确保a和b在有效范围内
            a = Math.max(0, a);
            b = Math.min(4, b);

            // 对于连续随机变量，单点概率为0
            if (Math.abs(a - b) < 1e-10) return 0;

            if (a >= b) return 0;

            // 使用CDF计算概率: P(a ≤ X ≤ b) = F(b) - F(a)
            return piecewiseCDF(b) - piecewiseCDF(a);
        }

        // 初始化PDF图表
        const pdfCtx = document.getElementById('pdf-chart').getContext('2d');
        let pdfChart = new Chart(pdfCtx, {
            type: 'line',
            data: {
                datasets: [{
                    label: '概率密度函数 f(x)',
                    data: [],
                    borderColor: 'rgb(37, 99, 235)',
                    backgroundColor: 'rgba(37, 99, 235, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    pointRadius: 0,
                    tension: 0  // 设置为0确保直线段保持直线
                }, {
                    label: 'P(a ≤ X ≤ b)',
                    data: [],
                    borderColor: 'rgba(46, 204, 113, 1.0)',
                    backgroundColor: 'rgba(46, 204, 113, 0.5)',
                    borderWidth: 2,
                    fill: true,
                    pointRadius: 0,
                    tension: 0  // 设置为0确保直线段保持直线
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        type: 'linear',
                        title: {
                            display: true,
                            text: 'x',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        min: -0.5,
                        max: 4.5,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'f(x)',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        min: 0,
                        max: 0.6,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: function (context) {
                                return context.dataset.label + ': ' + context.parsed.y.toFixed(3);
                            }
                        }
                    }
                }
            }
        });

        // 初始化CDF图表
        const cdfCtx = document.getElementById('cdf-chart').getContext('2d');
        let cdfChart = new Chart(cdfCtx, {
            type: 'line',
            data: {
                datasets: [{
                    label: '分布函数 F(x)',
                    data: [],
                    borderColor: 'rgb(37, 99, 235)',
                    backgroundColor: 'rgba(37, 99, 235, 0.1)',
                    borderWidth: 3,
                    fill: false,
                    pointRadius: 0,
                    tension: 0
                }, {
                    label: 'F(a)，F(b)',
                    data: [],
                    borderColor: 'rgba(231, 76, 60, 1)',
                    backgroundColor: 'rgba(231, 76, 60, 0.8)',
                    borderWidth: 0,
                    pointRadius: 6,
                    pointHoverRadius: 8,
                    showLine: false
                }, {
                    label: 'P(a ≤ X ≤ b) = F(b) - F(a)',
                    data: [],
                    borderColor: 'rgba(46, 204, 113, 1.0)',
                    backgroundColor: 'rgba(0, 0, 0, 0)',
                    borderWidth: 2,
                    fill: false,
                    pointRadius: 0,
                    tension: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        type: 'linear',
                        title: {
                            display: true,
                            text: 'x',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        min: -0.5,
                        max: 4.5,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'F(x)',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        min: 0, // 从0开始
                        max: 1.1,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: function (context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    label += context.parsed.y.toFixed(3);
                                }
                                return label;
                            }
                        }
                    }
                }
            }
        });

        // 生成PDF数据点，确保垂直边界
        function generatePDFData() {
            const data = [];

            // x < 0 部分
            data.push({ x: -0.5, y: 0 });
            data.push({ x: 0, y: 0 });

            // 第一段: 0 ≤ x < 2, f(x) = 0.25
            data.push({ x: 0, y: 0.25 });
            for (let x = 0.05; x < 2; x += 0.05) {
                data.push({ x: x, y: 0.25 });
            }

            // 在x=2处确保垂直边界
            data.push({ x: 2, y: 0.25 });
            data.push({ x: 2, y: -0.25 * 2 + 1 }); // f(2) = -0.25*2 + 1 = 0.5

            // 第二段: 2 ≤ x ≤ 4, f(x) = -0.25x + 1
            for (let x = 2.05; x <= 4; x += 0.05) {
                data.push({ x: x, y: -0.25 * x + 1 });
            }

            // x > 4 部分
            data.push({ x: 4, y: 0 });
            data.push({ x: 4.5, y: 0 });

            return data;
        }

        // 生成CDF数据点
        function generateCDFData() {
            const data = [];

            // x < 0 部分
            data.push({ x: -0.5, y: 0 });
            data.push({ x: 0, y: 0 });

            // 第一段: 0 ≤ x < 2, F(x) = 0.25x
            for (let x = 0; x < 2; x += 0.05) {
                data.push({ x: x, y: 0.25 * x });
            }

            // 在x=2处确保连续性
            data.push({ x: 2, y: 0.5 });

            // 第二段: 2 ≤ x ≤ 4, F(x) = -0.125x² + x - 1
            for (let x = 2.05; x <= 4; x += 0.05) {
                data.push({ x: x, y: -0.125 * x * x + x - 1 });
            }

            // x > 4 部分
            data.push({ x: 4, y: 1 });
            data.push({ x: 4.5, y: 1 });

            return data;
        }

        // 更新CDF高亮区域 - 保留紫色落差线，但移除填充
        function updateCDFHighlight(a, b) {
            const pointsData = [];
            const probData = [];

            // 对于单点概率，不显示高亮区域
            if (Math.abs(a - b) < 1e-10) {
                return { pointsData, probData };
            }

            // 添加F(a)点
            const fA = piecewiseCDF(a);
            pointsData.push({ x: a, y: fA });

            // 添加F(b)点
            const fB = piecewiseCDF(b);
            pointsData.push({ x: b, y: fB });

            // 添加概率区域 - 只绘制线条，不填充
            probData.push({ x: a, y: fA });
            probData.push({ x: a, y: fA });
            probData.push({ x: b, y: fA });
            probData.push({ x: b, y: fB });

            return { pointsData, probData };
        }

        // 更新PDF高亮区域 - 确保边界线垂直
        function updatePDFHighlight(a, b) {
            const highlightData = [];

            // 对于单点概率，不显示高亮区域
            if (Math.abs(a - b) < 1e-10) return highlightData;

            // 添加起点 (a, 0)
            highlightData.push({ x: a, y: 0 });

            // 添加起点 (a, f(a)) - 垂直线
            highlightData.push({ x: a, y: piecewisePDF(a) });

            // 添加高亮区域 - 确保在x=2处有垂直边界
            // 如果区间包含x=2，需要分别处理左右两段
            if (a < 2 && b > 2) {
                // 第一段: a 到 2
                for (let x = a; x < 2; x += 0.05) {
                    highlightData.push({ x: x, y: piecewisePDF(x) });
                }
                // 在x=2处添加两个点以确保垂直边界
                highlightData.push({ x: 2, y: 0.25 }); // 左极限
                highlightData.push({ x: 2, y: 0.5 });  // 右极限

                // 第二段: 2 到 b
                for (let x = 2.05; x <= b; x += 0.05) {
                    highlightData.push({ x: x, y: piecewisePDF(x) });
                }
            } else {
                // 区间不跨越x=2
                for (let x = a; x <= b; x += 0.05) {
                    highlightData.push({ x: x, y: piecewisePDF(x) });
                }
            }

            // 添加终点 (b, f(b)) - 垂直线
            highlightData.push({ x: b, y: piecewisePDF(b) });

            // 添加终点 (b, 0)
            highlightData.push({ x: b, y: 0 });

            return highlightData;
        }

        // 初始化图表数据
        pdfChart.data.datasets[0].data = generatePDFData();
        cdfChart.data.datasets[0].data = generateCDFData();
        pdfChart.update();
        cdfChart.update();

        // 获取滑块元素
        const aSlider = document.getElementById('a-slider');
        const bSlider = document.getElementById('b-slider');
        const aDisplay = document.getElementById('a-display');
        const bDisplay = document.getElementById('b-display');
        const aValue = document.getElementById('a-value');
        const bValue = document.getElementById('b-value');
        const aValueF = document.getElementById('a-value-f');
        const bValueF = document.getElementById('b-value-f');
        const probabilityDisplay = document.getElementById('probability');
        const probabilityDisplayF = document.getElementById('probability-f');

        // 更新显示的函数
        function updateDisplay() {
            const a = parseFloat(aSlider.value);
            const b = parseFloat(bSlider.value);

            // 确保a <= b
            if (a > b) {
                aSlider.value = b;
                bSlider.value = a;
                updateDisplay();
                return;
            }

            // 更新显示值
            aDisplay.textContent = a.toFixed(2);
            bDisplay.textContent = b.toFixed(2);
            aValue.textContent = a.toFixed(2);
            bValue.textContent = b.toFixed(2);
            aValueF.textContent = a.toFixed(2);
            bValueF.textContent = b.toFixed(2);

            // 计算并显示概率
            const probability = calculateProbability(a, b);
            probabilityDisplay.textContent = probability.toFixed(3);
            probabilityDisplayF.textContent = probability.toFixed(3);

            // 更新PDF高亮区域
            pdfChart.data.datasets[1].data = updatePDFHighlight(a, b);
            pdfChart.update();

            // 更新CDF高亮区域 - 合并到一个数据集
            const highlightData = updateCDFHighlight(a, b);
            cdfChart.data.datasets[1].data = highlightData.pointsData;
            cdfChart.data.datasets[2].data = highlightData.probData;
            cdfChart.update();
        }

        // 添加事件监听器
        aSlider.addEventListener('input', updateDisplay);
        bSlider.addEventListener('input', updateDisplay);

        // 初始更新
        updateDisplay();
    </script>
</body>

</html>